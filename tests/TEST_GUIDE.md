# テスト実行ガイド

## テストの目的

Element Clip拡張機能の品質を保証するため、以下のテストを実施します：

1. **ユニットテスト**: 個々の関数の動作確認
2. **統合テスト**: utils.jsの読み込みとcontent.jsとの連携確認
3. **回帰テスト**: 過去のバグが再発しないことを確認

## テストの実行方法

### 1. ブラウザでテストランナーを開く

ファイルパスをブラウザで開く：
```
file:///d:/ProjectS/Program/anti_demo/element_clip/tests/test-runner.html
```

### 2. テスト結果の確認

- ✅ **緑色**: テスト成功
- ❌ **赤色**: テスト失敗

すべてのテストが緑色（成功）であることを確認してください。

## テストケース一覧

### 統合テスト - utils.js読み込み確認（4件）

これらのテストは、v1.0.0で発生したバグ（utils.jsが読み込まれていない）を検出します：

1. **utils.jsが正しく読み込まれている**
   - すべての主要関数が定義されているか確認

2. **すべてのユーティリティ関数が呼び出し可能**
   - 各関数が`function`型であることを確認

3. **content.jsで必要な関数が利用可能**
   - generateSelector、extractValueBySelector、pasteValueBySelectorが実際に動作するか確認
   - これは最も重要なテスト（バグの直接的な検出）

4. **関数のエラーハンドリング**
   - null要素や存在しない要素に対する適切なエラーハンドリング

### CSSセレクタ生成テスト（3件）

- ID要素のセレクタ生成
- クラス要素のセレクタ生成
- null要素のセレクタ生成

### 値抽出テスト（4件）

- input要素のvalue抽出
- div要素のtext抽出
- 属性値の抽出
- innerHTML抽出

### 値貼り付けテスト（3件）

- input要素への貼り付け
- textarea要素への貼り付け
- null要素への貼り付け

### UUID生成テスト（2件）

- UUID形式の確認
- UUID一意性の確認

### タイムスタンプテスト（2件）

- タイムスタンプ生成
- タイムスタンプのフォーマット

### セレクタ操作テスト（4件）

- セレクタによる値抽出
- セレクタによる値貼り付け
- 存在しないセレクタでの抽出
- 存在しないセレクタでの貼り付け

## 合計テストケース数

**25件のテストケース**（統合テスト4件 + ユニットテスト21件）

## バグ検出の仕組み

### v1.0.0のバグ：utils.jsが読み込まれていない

**症状**: 要素をクリックしてもCSSセレクタが生成されない

**原因**: `manifest.json`の`content_scripts`に`utils.js`が含まれていなかった

**検出方法**: 
- 統合テストの「utils.jsが正しく読み込まれている」テストが失敗
- 統合テストの「content.jsで必要な関数が利用可能」テストが失敗
- エラーメッセージ: `generateSelector関数が定義されているべき`

### v1.0.1での修正

`manifest.json`の`content_scripts`を以下のように修正：

```json
"content_scripts": [
  {
    "matches": ["<all_urls>"],
    "js": ["utils.js", "content.js"],  // utils.jsを追加
    "run_at": "document_idle"
  }
]
```

## テストの保守

新しい機能を追加する際は、対応するテストケースも追加してください：

1. **新しいユーティリティ関数を追加した場合**
   - 統合テストに関数の存在確認を追加
   - ユニットテストに動作確認テストを追加

2. **バグを修正した場合**
   - 回帰テストを追加して同じバグが再発しないようにする

3. **新しい機能を追加した場合**
   - エンドツーエンドのテストシナリオを考慮

## トラブルシューティング

### テストが実行されない

- ファイルパスが正しいか確認
- ブラウザのコンソールでエラーを確認
- `utils.js`が正しい場所にあるか確認

### 一部のテストが失敗する

- エラーメッセージを確認
- 該当する関数の実装を確認
- コンソールログで詳細を確認

### すべてのテストが失敗する

- `utils.js`が読み込まれていない可能性
- ブラウザのコンソールで`generateSelector`などを実行して確認
- ファイルパスが正しいか確認
